SELECT 
		PFUNC.CODCOLIGADA,
		PFUNC.CHAPA,
		PFUNC.NOME,
		PSECAO.DESCRICAO AS SECAO,
		PFUNCAO.NOME AS FUNCAO,
		PCODSITUACAO.DESCRICAO AS SITUACAO,
		VTIPOEXAME.DESCRICAO AS TIPOEXAME,
		VEXAMESPEND.DATAPROXEXAME AS DATAEXAME,
		CASE
			WHEN VEXAMESPEND.REALIZADO = 0 THEN 'Pendente'
			WHEN VEXAMESPEND.REALIZADO = 1 THEN 'Realizado'
			WHEN VEXAMESPEND.REALIZADO = 2 THEN 'Exclu√≠do'
		END AS SITUACAOEXAME
		
FROM PFUNC
		JOIN PSECAO (NOLOCK) ON
				PSECAO.CODIGO=PFUNC.CODSECAO
			AND PSECAO.CODCOLIGADA=PFUNC.CODCOLIGADA
		JOIN PFUNCAO (NOLOCK) ON
				PFUNCAO.CODIGO=PFUNC.CODFUNCAO
			AND PFUNCAO.CODCOLIGADA=PFUNC.CODCOLIGADA
		JOIN PCODSITUACAO (NOLOCK) ON
				PCODSITUACAO.CODCLIENTE=PFUNC.CODSITUACAO
		FULL JOIN VEXAMESPEND (NOLOCK) ON
				VEXAMESPEND.CODCOLIGADA=PFUNC.CODCOLIGADA
			AND VEXAMESPEND.CHAPA=PFUNC.CHAPA
		JOIN VTIPOEXAME (NOLOCK) ON
				VTIPOEXAME.CODCLIENTE=VEXAMESPEND.TIPOEXAME

WHERE 1=1
		AND VEXAMESPEND.REALIZADO <> 2

ORDER BY 
		NOME
